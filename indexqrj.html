<!DOCTYPE html>
<html>
    

    
    <script>
    window.myAppData = {};
    var dotid=[
    {
        "herb": "白扁豆",
        "id": "1"
    },
    {
        "herb": "白芍",
        "id": "2"
    },
    {
        "herb": "白术",
        "id": "3"
    },
    {
        "herb": "白头翁",
        "id": "4"
    },
    {
        "herb": "白芷",
        "id": "5"
    },
    {
        "herb": "板蓝根",
        "id": "6"
    },
    {
        "herb": "半夏",
        "id": "7"
    },
    {
        "herb": "薄荷",
        "id": "8"
    },
    {
        "herb": "鳖甲",
        "id": "9"
    },
    {
        "herb": "槟榔",
        "id": "10"
    },
    {
        "herb": "柴胡",
        "id": "11"
    },
    {
        "herb": "陈皮",
        "id": "12"
    },
    {
        "herb": "赤芍",
        "id": "13"
    },
    {
        "herb": "川贝母",
        "id": "14"
    },
    {
        "herb": "川芎",
        "id": "15"
    },
    {
        "herb": "大黄",
        "id": "16"
    },
    {
        "herb": "丹参",
        "id": "17"
    },
    {
        "herb": "淡竹叶",
        "id": "18"
    },
    {
        "herb": "当归",
        "id": "19"
    },
    {
        "herb": "地骨皮",
        "id": "20"
    },
    {
        "herb": "地黄",
        "id": "21"
    },
    {
        "herb": "防风",
        "id": "22"
    },
    {
        "herb": "蜂蜜",
        "id": "23"
    },
    {
        "herb": "茯苓",
        "id": "24"
    },
    {
        "herb": "甘草",
        "id": "25"
    },
    {
        "herb": "葛根",
        "id": "26"
    },
    {
        "herb": "厚朴",
        "id": "27"
    },
    {
        "herb": "胡黄连",
        "id": "28"
    },
    {
        "herb": "滑石粉",
        "id": "29"
    },
    {
        "herb": "黄柏",
        "id": "30"
    },
    {
        "herb": "黄连",
        "id": "31"
    },
    {
        "herb": "黄芪",
        "id": "32"
    },
    {
        "herb": "黄芩",
        "id": "33"
    },
    {
        "herb": "僵蚕",
        "id": "34"
    },
    {
        "herb": "金银花",
        "id": "35"
    },
    {
        "herb": "荆芥炭",
        "id": "36"
    },
    {
        "herb": "桔梗",
        "id": "37"
    },
    {
        "herb": "连翘",
        "id": "38"
    },
    {
        "herb": "龙胆",
        "id": "39"
    },
    {
        "herb": "麻黄",
        "id": "40"
    },
    {
        "herb": "马勃",
        "id": "41"
    },
    {
        "herb": "麦冬",
        "id": "42"
    },
    {
        "herb": "芒硝",
        "id": "43"
    },
    {
        "herb": "没药",
        "id": "44"
    },
    {
        "herb": "牡丹皮",
        "id": "45"
    },
    {
        "herb": "木通",
        "id": "46"
    },
    {
        "herb": "木香",
        "id": "47"
    },
    {
        "herb": "牛蒡子",
        "id": "48"
    },
    {
        "herb": "牛膝",
        "id": "49"
    },
    {
        "herb": "秦艽",
        "id": "50"
    },
    {
        "herb": "秦皮",
        "id": "51"
    },
    {
        "herb": "青蒿",
        "id": "52"
    },
    {
        "herb": "人参",
        "id": "53"
    },
    {
        "herb": "肉桂",
        "id": "54"
    },
    {
        "herb": "乳香",
        "id": "55"
    },
    {
        "herb": "桑白皮",
        "id": "56"
    },
    {
        "herb": "升麻",
        "id": "57"
    },
    {
        "herb": "石膏",
        "id": "58"
    },
    {
        "herb": "石斛",
        "id": "59"
    },
    {
        "herb": "熟地黄",
        "id": "60"
    },
    {
        "herb": "水牛角",
        "id": "61"
    },
    {
        "herb": "天花粉",
        "id": "62"
    },
    {
        "herb": "吴茱萸",
        "id": "63"
    },
    {
        "herb": "西洋参",
        "id": "64"
    },
    {
        "herb": "香薷",
        "id": "65"
    },
    {
        "herb": "玄参",
        "id": "66"
    },
    {
        "herb": "银柴胡",
        "id": "67"
    },
    {
        "herb": "皂角刺",
        "id": "68"
    },
    {
        "herb": "泽泻",
        "id": "69"
    },
    {
        "herb": "知母",
        "id": "70"
    },
    {
        "herb": "栀子",
        "id": "71"
    },
    {
        "herb": "炙甘草",
        "id": "72"
    },
    {
        "herb": "猪苓",
        "id": "73"
    }
]  
    
    var myfjdata=[{"herb": "白扁豆", "xx": "14.65978527", "yy": "9.513235092"}, {"herb": "白芍", "xx": "12.38781261", "yy": "12.18961525"}, {"herb": "白术", "xx": "14.60186291", "yy": "9.2846632"}, {"herb": "白头翁", "xx": "12.64338112", "yy": "13.05992126"}, {"herb": "白芷", "xx": "13.63412476", "yy": "8.299510956"}, {"herb": "板蓝根", "xx": "13.01016426", "yy": "13.12999249"}, {"herb": "半夏", "xx": "14.13132858", "yy": "8.940090179"}, {"herb": "薄荷", "xx": "12.76311588", "yy": "8.833387375"}, {"herb": "鳖甲", "xx": "13.38384914", "yy": "11.74724102"}, {"herb": "槟榔", "xx": "13.91357994", "yy": "8.2078228"}, {"herb": "柴胡", "xx": "11.97350025", "yy": "11.42608833"}, {"herb": "陈皮", "xx": "13.79045391", "yy": "8.903289795"}, {"herb": "赤芍", "xx": "12.58838081", "yy": "11.93789101"}, {"herb": "川贝母", "xx": "14.49792004", "yy": "13.26351547"}, {"herb": "川芎", "xx": "13.16576481", "yy": "9.843824387"}, {"herb": "大黄", "xx": "11.93157768", "yy": "12.85854244"}, {"herb": "丹参", "xx": "11.8939743", "yy": "12.2536478"}, {"herb": "淡竹叶", "xx": "15.34887695", "yy": "12.75925541"}, {"herb": "当归", "xx": "13.54918957", "yy": "10.00778389"}, {"herb": "地骨皮", "xx": "14.2449913", "yy": "11.51007557"}, {"herb": "地黄", "xx": "13.90628052", "yy": "11.6269722"}, {"herb": "防风", "xx": "13.7849102", "yy": "9.71850872"}, {"herb": "蜂蜜", "xx": "15.47900105", "yy": "10.36977673"}, {"herb": "茯苓", "xx": "15.56180668", "yy": "10.89439106"}, {"herb": "甘草", "xx": "15.78024673", "yy": "10.75037861"}, {"herb": "葛根", "xx": "14.63266468", "yy": "10.146245"}, {"herb": "厚朴", "xx": "13.95370102", "yy": "8.478273392"}, {"herb": "胡黄连", "xx": "12.37334538", "yy": "12.54133034"}, {"herb": "滑石粉", "xx": "15.29848766", "yy": "12.22805595"}, {"herb": "黄柏", "xx": "13.08891487", "yy": "12.24213123"}, {"herb": "黄连", "xx": "12.16651249", "yy": "13.04343987"}, {"herb": "黄芪", "xx": "14.8070097", "yy": "9.679710388"}, {"herb": "黄芩", "xx": "12.60699272", "yy": "13.28019238"}, {"herb": "僵蚕", "xx": "12.67381954", "yy": "9.053496361"}, {"herb": "金银花", "xx": "15.54740524", "yy": "12.43035698"}, {"herb": "荆芥炭", "xx": "13.20526791", "yy": "8.999073982"}, {"herb": "桔梗", "xx": "12.31416702", "yy": "8.987830162"}, {"herb": "连翘", "xx": "13.48907948", "yy": "13.34911442"}, {"herb": "龙胆", "xx": "12.3193779", "yy": "11.62170887"}, {"herb": "麻黄", "xx": "13.32111835", "yy": "8.608868599"}, {"herb": "马勃", "xx": "12.74641132", "yy": "8.714697838"}, {"herb": "麦冬", "xx": "14.0455389", "yy": "13.17336369"}, {"herb": "芒硝", "xx": "12.54435349", "yy": "12.6883955"}, {"herb": "没药", "xx": "12.3148756", "yy": "10.13250065"}, {"herb": "牡丹皮", "xx": "11.85710716", "yy": "11.84524918"}, {"herb": "木通", "xx": "13.2485857", "yy": "13.35712624"}, {"herb": "木香", "xx": "14.07097149", "yy": "8.388224602"}, {"herb": "牛蒡子", "xx": "13.9044342", "yy": "12.59880161"}, {"herb": "牛膝", "xx": "13.85041523", "yy": "11.19984913"}, {"herb": "秦艽", "xx": "12.17142963", "yy": "10.57996559"}, {"herb": "秦皮", "xx": "12.24399757", "yy": "11.91478348"}, {"herb": "青蒿", "xx": "12.22982597", "yy": "11.3500824"}, {"herb": "人参", "xx": "15.03063679", "yy": "9.909865379"}, {"herb": "肉桂", "xx": "13.2063427", "yy": "10.45853043"}, {"herb": "乳香", "xx": "12.97009754", "yy": "9.981665611"}, {"herb": "桑白皮", "xx": "15.07508564", "yy": "12.46360111"}, {"herb": "升麻", "xx": "14.84619427", "yy": "10.54172897"}, {"herb": "石膏", "xx": "15.10487556", "yy": "12.33476925"}, {"herb": "石斛", "xx": "14.59592247", "yy": "12.21552563"}, {"herb": "熟地黄", "xx": "14.07331371", "yy": "11.0332613"}, {"herb": "水牛角", "xx": "12.01557827", "yy": "12.3051405"}, {"herb": "天花粉", "xx": "14.78331947", "yy": "12.76857376"}, {"herb": "吴茱萸", "xx": "12.66475773", "yy": "10.41291618"}, {"herb": "西洋参", "xx": "14.36651325", "yy": "13.40520668"}, {"herb": "香薷", "xx": "13.20750999", "yy": "8.808053017"}, {"herb": "玄参", "xx": "14.47839737", "yy": "12.74432564"}, {"herb": "银柴胡", "xx": "14.35911846", "yy": "12.00121021"}, {"herb": "皂角刺", "xx": "13.24759388", "yy": "9.313106537"}, {"herb": "泽泻", "xx": "14.94112873", "yy": "11.88385677"}, {"herb": "知母", "xx": "14.54339314", "yy": "12.62162018"}, {"herb": "栀子", "xx": "13.56966114", "yy": "12.92961788"}, {"herb": "炙甘草", "xx": "15.79423523", "yy": "10.76484489"}, {"herb": "猪苓", "xx": "14.84781837", "yy": "11.46231842"}]
      var allxx=[14.65978527,12.38781261,14.60186291,12.64338112,13.63412476,13.01016426,14.13132858,12.76311588,13.38384914,13.91357994,11.97350025,13.79045391,12.58838081,14.49792004,13.16576481,11.93157768,11.8939743,15.34887695,13.54918957,14.2449913,13.90628052,13.7849102,15.47900105,15.56180668,15.78024673,14.63266468,13.95370102,12.37334538,15.29848766,13.08891487,12.16651249,14.8070097,12.60699272,12.67381954,15.54740524,13.20526791,12.31416702,13.48907948,12.3193779,13.32111835,12.74641132,14.0455389,12.54435349,12.3148756,11.85710716,13.2485857,14.07097149,13.9044342,13.85041523,12.17142963,12.24399757,12.22982597,15.03063679,13.2063427,12.97009754,15.07508564,14.84619427,15.10487556,14.59592247,14.07331371,12.01557827,14.78331947,12.66475773,14.36651325,13.20750999,14.47839737,14.35911846,13.24759388,14.94112873,14.54339314,13.56966114,15.79423523,14.84781837]
      var allyy=[9.513235092,12.18961525,9.2846632,13.05992126,8.299510956,13.12999249,8.940090179,8.833387375,11.74724102,8.2078228,11.42608833,8.903289795,11.93789101,13.26351547,9.843824387,12.85854244,12.2536478,12.75925541,10.00778389,11.51007557,11.6269722,9.71850872,10.36977673,10.89439106,10.75037861,10.146245,8.478273392,12.54133034,12.22805595,12.24213123,13.04343987,9.679710388,13.28019238,9.053496361,12.43035698,8.999073982,8.987830162,13.34911442,11.62170887,8.608868599,8.714697838,13.17336369,12.6883955,10.13250065,11.84524918,13.35712624,8.388224602,12.59880161,11.19984913,10.57996559,11.91478348,11.3500824,9.909865379,10.45853043,9.981665611,12.46360111,10.54172897,12.33476925,12.21552563,11.0332613,12.3051405,12.76857376,10.41291618,13.40520668,8.808053017,12.74432564,12.00121021,9.313106537,11.88385677,12.62162018,12.92961788,10.76484489,11.46231842]
      function bubbleSort(arr) {
          if (Array.isArray(arr)) {
            for (var i = arr.length - 1; i > 0; i--) {
              for (var j = 0; j < i; j++) {
                if (arr[j] > arr[j + 1]) {
                  [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                }
              }
            }
            return arr;
          }
     }
    
    //console.log(allxx)
    function clearFunction() {
     d3.select("#svg001")
        .attr("id","svg000")
    }
    function realclearFunction() {
     d3.select("#svg000")
        .attr("id","svg001")
    }
    function myFunction() {
        var bacxx=[-2.968632936,-3.140700817,-4.655617714,-4.523247719,-4.429934025,-1.504244208,-3.824779987,-4.528208733,-3.906730175,-3.413937092,-4.269578934,-3.238331079,-1.886649609,-3.309570789,-1.373338819,-2.883019924,-2.77603507,-2.738422632,-1.581794739,-2.987339973,-2.257733583,-2.261112452,-2.423458576,-3.002579689,-3.841306448,-4.049615383,-2.297468424,-1.513089895,-3.865788221,-4.109154224,-2.597402573,-3.590692997,-2.100105047,-2.701319695,-2.664515972,-1.91862309,-1.977849483,-3.960914612,-3.765055656,-2.559403658,-2.753558159,-2.083695889,-2.545398951,-1.41849494,-4.61407423,-2.168384314,-1.60704124,-2.97184515,-3.198005676,-3.057582855,-2.354230642,-2.4959867,-2.003940582,-3.425074339,-3.735731125,-2.563746929,-2.309523344,-1.73198545]
        var bacyy=[0.178786859,0.942083657,-1.043939829,-0.609639764,-0.079158716,-0.00548108,0.357004225,-1.387471557,-0.022498643,0.252200156,-0.515816808,-0.787130058,0.680230796,-1.132460117,-1.060228109,-0.620351553,-1.917709827,-0.071033478,-2.248958111,-3.009689093,1.252760172,-3.802080393,1.586563945,-0.276521504,-3.153040886,-0.543394983,-3.011219263,-2.76542902,-3.743286133,-2.61918664,-4.429816246,-3.355566978,-2.541544199,-2.368893623,-1.804931641,-2.582026482,-4.042625904,-1.899103045,-2.320254803,-3.592699766,-4.271862507,-3.465502024,-2.752537489,-0.615175426,-1.565720201,1.319137931,-0.711083055,-3.365247965,-4.076366901,-3.728332996,0.802957475,-3.973608017,0.899944186,-0.160854667,-3.632935047,1.226793647,0.324441075,-1.045446277]
      var liverobj = document.getElementById("liverSelect");
      var liverindex = liverobj.selectedIndex; //选中索引
      var livertext = liverobj.options[liverindex].text; //选中文本
      var liverval = liverobj.options[liverindex].value; //选中值
        //console.log(liverindex)
        // //console.log(livertext)
        // //console.log(liverval)
        var heartobj = document.getElementById("heartSelect");
      var heartindex = heartobj.selectedIndex; //选中索引
        var spleenobj = document.getElementById("spleenSelect");
      var spleenindex = spleenobj.selectedIndex; //选中索引
        var lungobj = document.getElementById("lungSelect");
      var lungindex =lungobj.selectedIndex; //选中索引
        var kidneyobj = document.getElementById("kidneySelect");
      var kidneyindex = kidneyobj.selectedIndex; //选中索引
        //console.log(heartindex)
        //console.log(spleenindex)
        //console.log(lungindex)
        //console.log(kidneyindex)
        wuxingindex=[liverindex,heartindex,spleenindex,lungindex,kidneyindex]
        oriwuxingindex=[liverindex,heartindex,spleenindex,lungindex,kidneyindex]
        wuxingindex=bubbleSort(wuxingindex)
        //console.log(wuxingindex)
        //console.log(oriwuxingindex)
        xxx=[myfjdata[liverindex].xx,myfjdata[heartindex].xx,myfjdata[spleenindex].xx,myfjdata[lungindex].xx,myfjdata[kidneyindex].xx]
        yyy=[myfjdata[liverindex].yy,myfjdata[heartindex].yy,myfjdata[spleenindex].yy,myfjdata[lungindex].yy,myfjdata[kidneyindex].yy]
        //console.log(xxx)
        ori=[oriwuxingindex.indexOf(wuxingindex[0]),oriwuxingindex.indexOf(wuxingindex[1]),oriwuxingindex.indexOf(wuxingindex[2]),oriwuxingindex.indexOf(wuxingindex[3]),oriwuxingindex.indexOf(wuxingindex[4])]
        //console.log(ori)
        //console.log(yyy)
        xxx=xxx.map(Number)
        yyy=yyy.map(Number)
    
    for (var i=0;i<5;i++)
    { 
        bacxx.splice(bacxx.indexOf(xxx[i]), 1)
        bacyy.splice(bacyy.indexOf(yyy[i]), 1)
    }
    
    //console.log(bacxx)
    //console.log(bacyy)
    //eel.rgb2rgbbyj(xxx,yyy,bacxx,bacyy,wuxingindex,ori)
     }
    </script>
    
    


  <head>
    <meta charset="UTF-8">
    <title>tcmvistest</title>	
    <link rel="stylesheet" href="css/style.css" />
  </head>
 
  

  
  <div id="container">
    <div id="nav">
      <p>

        <a href="index.html">补益剂</a>|
        <a href="indexqrj.html">清热剂 </a>

      </p>
    </div>
    <!-- <div id="header">
      <p>中医方剂可视分析</p>
    </div> -->
    
    <!-- <div id="nav">
          <p>
        <a href="#">方剂分析</a>
        <a href="hello0715.html">补益剂</a>
        <a href="hello20715.html">清热剂 </a>|
        <a href="demo.html">病案分析</a>
      </p>
    </div> -->

    <div id="main"> 
      <div id="aside">
        <h2>清热剂药物视图&emsp;&emsp;<button id="collectData" class="button">确定</button></h2>
  
        <style>
  
        chart{
          font: 10px sans-serif;
        }

        #svg000{
          background-image:url("rbftest2.png");
          background-repeat:no-repeat;
          background-size:100% 100%;
          
          /* background-size:cover;  让背景图基于容器大小伸缩 */
          /* background-size:contain; */
      /* background-attachment:fixed; */

        }
        #svg001{
          background-image:none;/*加载背景图*/   /* 背景图不平铺 */

        }
        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }
        
        .dot {
          stroke: #000;
        }
        
        .lasso path {
          stroke: rgb(80,80,80);
          stroke-width:2px;
        }
        
        .lasso .drawn {
          fill-opacity:.05 ;
        }
        
        .lasso .loop_close {
          fill:none;
          stroke-dasharray: 4,4;
        }
        
        .lasso .origin {
          fill:#3399FF;
          fill-opacity:.5;
        }
        
        .not_possible {
          fill:rgb(200,200,200);
        }
        
        .possible {
          fill:#EC888C;
        }
        
        /* .text{
          fill:rgb(63, 13, 226);
        } */
        
        </style>
        
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script src = "http://axc.net/code_libraries/lasso/lasso.min.js"></script>
        <script src="d3-color.min.js"></script>
        <!-- <script src="d3-scale-chromatic.min.js"></script> -->
        <script type="text/javascript" src="forceInABox.js"></script>  
        <div id="chart"></div>
        <script>
        var color = d3.scale.category20();
        
        
        
        
        // var margin = {top: 20, right: 20, bottom: 30, left: 40},
        //   width = 1060 - margin.left - margin.right,
        //   height = 700 - margin.top - margin.bottom;
        width = 960
        height = 700
        
        var scalex = d3.scale.linear()
          .range([0, width]);
        
        var y = d3.scale.linear()
          .range([height, 0]);
        
        // var color = d3.scale.category10();
        
        var xAxis = d3.svg.axis()
          .scale(scalex)
          .orient("bottom");
        
        var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left");
        
        
            var tArray = new Array();  //先声明一维
        for(var k=0;k<26;k++){    //一维长度为i,i为变量，可以根据实际情况改变
         
        tArray[k]=new Array();  //声明二维，每一个一维数组里面的一个元素都是一个数组；
         
        for(var j=0;j<26;j++){   //一维数组里面每个元素数组可以包含的数量p，p也是一个变量；
         
        tArray[k][j]="";    //这里将变量初始化，我这边统一初始化为空，后面在用所需的值覆盖里面的值
         }
        }
  
        tArray[0]= ['白虎汤★','石膏','知母','甘草','','','','','','','','','','','','','','']
        tArray[1]= ['玉女煎★','石膏','熟地黄','麦冬','知母','牛膝','','','','','','','','','','','','']
        tArray[2]= ['竹叶石膏汤★','石膏','淡竹叶','半夏','麦冬','人参','炙甘草','','','','','','','','','','','']
        tArray[3]= ['清瘟败毒饮','石膏','水牛角','黄连','栀子','桔梗','黄芩','知母','赤芍','玄参','连翘','甘草','牡丹皮','淡竹叶','','','','']
        tArray[4]= ['六一散','滑石粉','甘草','','','','','','','','','','','','','','','']
        tArray[5]= ['桂苓甘露饮','滑石粉','茯苓','甘草','白术','泽泻','肉桂','石膏','猪苓','','','','','','','','','']
        tArray[6]= ['左金丸（回令丸）★','黄连','吴茱萸','','','','','','','','','','','','','','','']
        tArray[7]= ['黃连解毒汤★','黄连','栀子','黄芩','黄柏','','','','','','','','','','','','','']
        tArray[8]= ['清胃散★','黄连','地黄','当归','牡丹皮','升麻','','','','','','','','','','','','']
        tArray[9]= ['普济消毒饮★','黄芩','黄连','陈皮','甘草','玄参','柴胡','桔梗','连翘','板蓝根','马勃','牛蒡子','薄荷','僵蚕','升麻','','','']
        tArray[10]= ['犀角地黄汤★','水牛角','地黄','赤芍','','牡丹皮','','','','','','','','','','','','']
        tArray[11]= ['清营汤★','水牛角','地黄','玄参','淡竹叶','麦冬','丹参','黄连','金银花','连翘','','','','','','','','']
        tArray[12]= ['芍药汤★','赤芍','当归','黄连','槟榔','木香','甘草','大黄','黄芩','肉桂','','','','','','','','']
        tArray[13]= ['龙胆泻肝汤★','龙胆','柴胡','泽泻','木通','黄芩','栀子','当归','地黄','甘草','','','','','','','','']
        tArray[14]= ['青蒿鳖甲汤★','青蒿','鳖甲','地黄','知母','牡丹皮','','','','','','','','','','','','']
        tArray[15]= ['白头翁汤★','白头翁','黄柏','黄连','秦皮','','','','','','','','','','','','','']
        tArray[16]= ['导赤散★','木通','地黄','甘草','淡竹叶','','','','','','','','','','','','','']
        tArray[17]= ['凉膈散★','连翘','大黄','芒硝','甘草','栀子','薄荷','黄芩','淡竹叶','蜂蜜','','','','','','','','']
        tArray[18]= ['清暑益气汤','西洋参','石斛','麦冬','黄连','淡竹叶','知母','甘草','','','','','','','','','','']
        tArray[19]= ['泻白散★','桑白皮','地骨皮','炙甘草','','','','','','','','','','','','','','']
        tArray[20]= ['仙方活命饮★','金银花','白芷','川贝母','防风','赤芍','当归','甘草','皂角刺','天花粉','乳香','没药','陈皮','','','','','']
        tArray[21]= ['清骨散★','银柴胡','胡黄连','秦艽','鳖甲','地骨皮','青蒿','知母','甘草','','','','','','','','','']
        tArray[22]= ['葛根黄芩黄连汤★','葛根','炙甘草','黄芩','黄连','','','','','','','','','','','','','']
        tArray[23]= ['当归六黄汤★','当归','地黄','熟地黃','黄芩','黄连','黄柏','黄芪','','','','','','','','','','']
        tArray[24]= ['香薷散','香薷','白扁豆','厚朴','','','','','','','','','','','','','','']
        tArray[25]= ['防风通圣散★','麻黄','荆芥炭','防风','薄荷','大黄','芒硝','滑石粉','栀子','连翘','川芎','当归','白芍','白术','石膏','黄芩','桔梗','甘草']
              // //console.log(tArray)
        
        
        
        var svg = d3.select("#chart").append("svg")
        .attr("width",860)
        .attr("height", 700)
        //.attr('viewBox','0 0 1160 644.44')
        
        .attr("id","svg001")
          .append("g")
          // .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
          var tipmargin = {top: 10, right: 30, bottom: 40, left: 50},
            tipwidth = 520 - tipmargin.left - tipmargin.right,
            tipheight = 520 - tipmargin.top - tipmargin.bottom;
          
          var tooltip = d3.select("#chart")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "2px")
            .style("width","650px")
            .style("margin","5px 20px 5px 40px")
            .style("border-radius", "5px")
            .style("padding", "5px")
        // Lasso functions to execute while lassoing
        var lasso_start = function() {
          lasso.items()
          .attr("r",8) // reset size
          .style("fill",null) // clear all of the fills
          .classed({"not_possible":true,"selected":false}); // style as not possible
        };
        
        var lasso_draw = function() {
          // Style the possible dots
          lasso.items().filter(function(d) {return d.possible===true})
          .classed({"not_possible":false,"possible":true});
        
          // Style the not possible dot
          lasso.items().filter(function(d) {return d.possible===false})
          .classed({"not_possible":true,"possible":false});
        };
        

        
        
        var lasso_end = function() {
        
          // Reset the color of all dots
          lasso.items()
           .style("fill", function(d) { return d.rgb });
        
          // Style the selected dots
          lasso.items().filter(function(d) {return d.selected===true})
          .classed({"not_possible":false,"possible":false,"text":true})
          .attr("r",15);
        
        
          // Reset the style of the not selected dots
          lasso.items().filter(function(d) {return d.selected===false})
          .classed({"not_possible":false,"possible":false,"text":false})
          .attr("r",8);
        
        selectarray1=new Array();
        selectarray=new Array();
        selectarray1=d3.selectAll(".text")
        selectarray=selectarray1[0]

        
        fjarray=new Array();
        for( var i=0; i<selectarray.length; i++ )
          {
            fjarray[i]=selectarray[i].__data__.herb
          }
           ////console.log(fjarray)
     
        newfj=new Array();
        function isContainArr(parent, child) {
          return child.every(item => {
          return parent.some(v => {
            return item == v
          })
          })
        }
        
          for( var i=0; i<26; i++ )
          {
            if(isContainArr(tArray[i], fjarray)==true&&fjarray.length!=0){
            newfj.push(tArray[i][0])
          }
          }
        //console.log("newfj:"+newfj)
        tooltip
        .html("可能的方剂为: "+newfj)
      
        .style("opacity", 1)
        re=[newfj,fjarray]
        return re
        
        };
        
        // Create the area where the lasso event can be triggered
        var lasso_area = svg.append("rect")
                    .attr("width",width)
                    .attr("height",height)
                    .style("opacity",0);

                    

        d3.csv("qrfangjidata0504.csv", function(error, data) {
          data.forEach(function(d) {
          d.yy = +d.yy;
          d.xx = +d.xx;
          });
        ////console.log(d3.extent(data, function(d) { return d.xx; }))
        ////console.log(d3.extent(data, function(d) { return d.yy; }))
        scalex.domain(d3.extent(data, function(d) { return d.xx; }));
          y.domain(d3.extent(data, function(d) { return d.yy; }));
          scalex.domain([11.5,16.7])
          y.domain([8,13.5])
          
          svg.selectAll(".dot")
            .data(data)
            .enter().append("circle")
            .attr("id",function(d,i) {return "dot_" + i;}) // added
            .attr("class", "dot")
            .attr("r", 8)
            // .attr("r", function(d) { return d.r; })
            .attr("cx", function(d) { return scalex(d.xx); })
            .attr("cy", function(d) { return y(d.yy); })
            .style("fill", function(d) { return d.rgb})
            .on("click", function(event, d) {
            // 切换 clickselected 类，并根据是否选中调整半径
            var isSelected = d3.select(this).classed("clickselected",);
            d3.select(this).classed("clickselected", !isSelected);
            d3.select(this).attr("r", !isSelected ? 15 : 8); // 如果选中，则半径为 15，否则重置为 8
        })
            .append("title")
            .text(function (d) { return d.properties});
        
            svg.append("g")
            .selectAll("dot")
            .data(data)
            .enter()
            .append('text')
            .attr("x", function (d) { return scalex(d.xx)+10 } )
            .attr("y", function (d) { return y(d.yy)+5 })
            .style('font-weight', 400)
            .style('font-size',15)
            .style('font-family', 'Arial')
            .style('fill', '#2c2c2c')
            .text(function (d) { return d.herb})



            d3.select("#collectData").on("click", function() {
        // 收集所有带有 clickselected 类的 dot 的数据
        var selectedData = d3.selectAll(".clickselected").data();
        var herbArray = selectedData.map(function(d) { return d.herb; });
        window.myAppData.herbArray = herbArray;
        highlightNodes(nodes, herbArray);
        
        newfj = [];
for (var i = 0; i < tArray.length; i++) {  // 假设 tArray 的长度是动态的
    if (isContainArr(tArray[i], herbArray) && herbArray.length !== 0) {
        newfj.push(tArray[i][0]);  // 假设你想添加 tArray[i] 的第一个元素
    }
}

highlightFjRec(newfj, fjrecdata);


tooltip
        .html("可能的方剂为: "+newfj)
      
        .style("opacity", 1)
    });

        });


        </script>
        
  
  
      
      </div>
  
      <div id="content">
      <h2>清热剂方剂视图 </h2>
      <style>
  
        .node {
          fill: #ddd;
          /* stroke:red; */
          stroke:rgb(110,30,30);
        }
        
        .label {
          font: 15px sans-serif;
          text-anchor: middle;
          fill:#2c2c2c 
  
        }
        .fjlabel {
          font: 13px sans-serif;
          text-anchor: middle;
          font-style:oblique;
          fill:#727272
  
        }
        .fjlabel2 {
          font: 13px sans-serif;
          text-anchor: middle;
          font-style:oblique;
          fill:#727272

        }
  
        /* .highlight {
          opacity: 0;
          stroke:#3399FF
          
        } */
        
        </style>
  
  <div id="treechart"></div>
  <script src="https://unpkg.com/textures@1.2.0/dist/textures.js"></script>
  <script>
  console.log(window.myAppData.herbArray+"hhhh");
  // var width = 960,
  //     height = 500;
  var treewidth = 1090, treeheight = 600,labelhight=60
  //var treewidth = 990, treeheight = 800,
   x = d3.scale.linear().range([0, width]),
   y = d3.scale.linear().range([0, height]);
  
  var color = d3.scale.category20();
  // var color = d3.scale.linear()
  //       .range(["white", "#69b3a2"])
  //       .domain([1,100])
  
  
  var svg0 = d3.select("#treechart").append("svg")
      .attr("width", treewidth)
      .attr("height", treeheight+100)
    .style("margin","0px 5px 0px 5px")
  
  var partition = d3.layout.partition()
      .sort(null)
      .size([treewidth, treeheight])
      .value(function(d) { return d.size; });
      //.value(function(d) { return d.size; });
  
    var partition1 = d3.layout.partition()
      .sort(null)
      .size([treewidth, labelhight])
      .value(function(d) { return d.size; });
  
    // var svg1 = d3.select("#treechart").append("svg")
    //   .attr("width", "990px")
    //     .attr("height", "80px")
    //       .style("margin","0px 5px 0px 5px")
  
      var tooltip2 = d3.select("#treechart")
          .append("div")
          .style("opacity", 0)
          .attr("class", "tooltip")
          .style("margin","5px 10px 5px 10px")
          .style("background-color", "white")
          .style("border", "solid")
          .style("border-width", "2px")
          .style("width","970px")
          .style("border-radius", "5px")
          .style("padding", "5px")
  
  
    var sel=d3.selectAll(".node")
    .style("stroke","rgb(0,47,167)")
  
      
      
  
      var mouseover = function(d) {
          tooltip2.style("opacity", 1)
          fjname=[]
            tooltipfj=d.fangji
            var n=tooltipfj.split("、");
            fjname=n
            // fjname.push([n])
            ////console.log(fjname)
            for(var i=0;i<fjname.length;i++)
            {
                for(var j=0;j<26;j++){
                  if (fjname[i]==tArray[j][0]) {
                    
                    for(var k=i;k<26;k++){
                       for (var a = 0; a < 73; a++) {
                      if(dotid[a].herb==tArray[j][k]){
                        
                        svg.select("#dot_"+a)
                       .attr("r",8)
                      }
                    }
                    }
                   
                    
                }
            }
          }

          d3.select(this)
        .style("stroke", "none")
        // .style("opacity", 1)
        .style("opacity", 0.75)
      }

        var mouseclickbackup = function(d) {
          var isSelected2 = d3.select(this).classed("nodeselected");
          tooltip2.style("opacity", 1)
          tooltip2
            .html("可能的方剂为: " + d.fangji)
            .style("left", (d3.mouse(this)[0]+70) + "px")
            .style("top", (d3.mouse(this)[1]) + "px")
            ////console.log(this)
          //   fjname=[]
          //   tooltipfj=d.fangji
          //   var n=tooltipfj.split("、");

          //   fjname=n

          //   for(var i=0;i<fjname.length;i++)
          //   {
          //       for(var j=0;j<20;j++){
          //         if (fjname[i]==tArray[j][0]) {
                    
          //           for(var k=i;k<20;k++){
          //              for (var a = 0; a < 58; a++) {
          //             if(dotid[a].herb==tArray[j][k]){
                       
          //               svg.select("#dot_"+a)
          //              .attr("r",15)
          //             }
          //           }
          //           }
                   
                    
          //       }
          //   }
          // }
            d3.select(this)
        .style("stroke", "none")
        .style("opacity", 1)  

        }
        var mouseclick = function(d) {
    // 切换 nodeselected 类
    var isSelected = d3.select(this).classed("nodeselected");
    d3.select(this)
        .classed("nodeselected", !isSelected)
        .style("opacity", !isSelected ? 1 : 0.75);  // 如果选中，不透明度为 1，否则为 0.75

    if (!isSelected) {
        // 显示 tooltip
        tooltip2.style("opacity", 1)
            .html("可能的方剂为: " + d.fangji)
            .style("left", (d3.mouse(this)[0] + 70) + "px")
            .style("top", (d3.mouse(this)[1]) + "px");

        // 逻辑处理增大相关点的半径
        // var fjname = d.fangji.split("、");
        // for (var i = 0; i < fjname.length; i++) {
        //     for (var j = 0; j < 20; j++) {
        //         if (fjname[i] == tArray[j][0]) {
        //             for (var k = i; k < 20; k++) {
        //                 for (var a = 0; a < 58; a++) {
        //                     if (dotid[a].herb == tArray[j][k]) {
        //                         svg.select("#dot_" + a)
        //                             .attr("r", 15);  // 增大点的半径
        //                     }
        //                 }
        //             }
        //         }
        //     }
        // }
    } else {
        // 隐藏 tooltip
        tooltip2.style("opacity", 0);

        // 逻辑处理恢复点的半径
        for (var a = 0; a < 73; a++) {
            svg.select("#dot_" + a)
                .attr("r", 8);  // 恢复点的半径到初始大小
        }
    }
}

        var mouseleave = function(d) {
          tooltip2.style("opacity", 0)



          fjname=[]
            tooltipfj=d.fangji
            var n=tooltipfj.split("、");
            fjname=n
            
            for(var i=0;i<fjname.length;i++)
            {
                for(var j=0;j<26;j++){
                  if (fjname[i]==tArray[j][0]) {
                    
                    for(var k=i;k<26;k++){
                       for (var a = 0; a < 73; a++) {
                      if(dotid[a].herb==tArray[j][k]){
                        
                        svg.select("#dot_"+a)
                       .attr("r",8)
                      }
                    }
                    }
                   
                    
                }
            }
          }




          d3.select(this)
        .style("stroke", "none")
        // .style("opacity", 1)
        .style("opacity", 0.75)
        }
  
  
  
      var mouseover2 = function(d) {
          tooltip2.style("opacity", 1)
          d3.select(this)
        .style("stroke", "rgb(0,47,167)")
      .style("stroke-opacity",1)
        .style("opacity", 0.75)}
        
        var mouseclick2 = function(d) {
          tooltip2
            .html("可能的方剂为: " + d.fangji)
            .style("left", (d3.mouse(this)[0]+70) + "px")
            .style("top", (d3.mouse(this)[1]) + "px")
            d3.select(this)
        .style("stroke", "rgb(0,47,167)")
      .style("stroke-opacity",1)
        .style("opacity", 1)  
        }
        var mouseleave2 = function(d) {
          tooltip2.style("opacity", 0)
          d3.select(this)
        .style("stroke", "rgb(0,47,167)")
      .style("stroke-opacity",1)
        .style("opacity", 0.75)
        }
  
      var mouseover3 = function(d) {
          tooltip2.style("opacity", 1)
          d3.select(this)
      .style("opacity", 0.75)
      .style("stroke", "red")
      .style("stroke-width", 2)
      .style("stroke-dasharray","3,5")
    }
        
        var mousemove3 = function(d) {
          tooltip2
            .html("可能的方剂为: " + d.fangji)
            .style("left", (d3.mouse(this)[0]+70) + "px")
            .style("top", (d3.mouse(this)[1]) + "px")
            d3.select(this)
        .style("opacity", 1)
        .style("stroke", "red")
        .style("stroke-width", 2)
        .style("stroke-dasharray","3,5")
        }
        var mouseleave3 = function(d) {
          tooltip2.style("opacity", 0)
          d3.select(this)
      .style("opacity", 0.75)
      .style("stroke", "red")
      .style("stroke-width", 2)
      .style("stroke-dasharray","3,5")
        }

        
  var ondiv=document.getElementById("aside");
  var treedata={
	"name": "清热剂","name2": "清热剂","fangji": "生脉散★、四君子汤★、参苓白术散★、八珍汤★、当归补血汤★、玉屏风散★、补中益气汤★、归脾汤★、龟鹿二仙胶★、右归丸、一贯煎★、肾气丸★、炙甘草汤(复脉汤)★、七宝美髯丹、大补阴丸★、四物汤★、六味地黄丸★、左归丸、地黄饮子★、完带汤★", 
	"children": 
	[
	  {
		"name": "石膏","name2": "石膏", "colour":"rgb(0,47,167)","fangji": "白虎汤★、玉女煎★、竹叶石膏汤★、清瘟败毒饮",
  		"children": 
		  [
			{
				"name": " ","name2": "石膏",  "fangji": "白虎汤★、玉女煎★、竹叶石膏汤★",
				"children": 
		  [
			
			{
				"name": "知母","name2": "知母","fangji": "白虎汤★、玉女煎★",
				"children": 
				[
					{
						"name": "甘草","name2": "甘草","fangji": "白虎汤★","size": 1
					},
					{
						"name": "熟地黄","name2": "熟地黄","fangji": "玉女煎★",
						"children": 
						[
							{
								"name": "牛膝","name2": "牛膝","fangji": "玉女煎★",
								"children":
								[
									{
										"name": "麦冬","name2": "麦冬","fangji": "玉女煎★","size": 1
									}
								]
							}
						]
					}
					
					
				]
   			},
			   {
				"name": "淡竹叶","name2": "淡竹叶", "fangji": "竹叶石膏汤★",		"children": 
				[
					{
						"name": "人参","name2": "人参","fangji": "竹叶石膏汤★",
						"children":
						[
							{
								"name": "炙甘草","name2": "炙甘草","fangji": "竹叶石膏汤★",
								"children":
								[
									{
										"name": "麦冬","name2": "麦冬","fangji": "竹叶石膏汤★",
										"children":
										[
											{
												"name": "半夏","name2": "半夏","fangji": "竹叶石膏汤★","size": 1

											}
										]
									}
								]
							}
						]
					}
				]
   			}
		]
	},
	{
		"name": "水牛角","colour":"rgb(0,47,167)", "name2": "水牛角","fangji": "清瘟败毒饮", 
		"children":
		[					
			{
				"name": "淡竹叶","name2": "淡竹叶","fangji": "清瘟败毒饮", 
				"children":
				[
					{
						"name": "甘草","name2": "甘草","fangji": "清瘟败毒饮", 
						"children": 
						[
							{
								"name": "知母","name2": "知母", "fangji": "清瘟败毒饮",
								"children":
								[
									{
										"name": "栀子","name2": "栀子","fangji": "清瘟败毒饮",  
										"children":
										[
											{
												"name": "桔梗","name2": "桔梗","fangji": "清瘟败毒饮",  
												"children":
												[
													{
														"name": "牡丹皮","name2": "牡丹皮","fangji": "清瘟败毒饮",  
														"children":
														[
															{
																"name": "赤芍","name2": "赤芍","fangji": "清瘟败毒饮",  
																"children": 
																[
																	{
																		"name": "黄连","name2": "黄连","fangji": "清瘟败毒饮",
																		"children":
																		[
																			{
																				"name": "黄芩","name2": "黄芩","fangji": "清瘟败毒饮",
																				"children":
																				[
																					{
																						"name": "连翘","name2": "连翘","fangji": "清瘟败毒饮",
																						"children":
																						[
																							{
																								"name": "玄参","name2": "玄参","fangji": "清瘟败毒饮","size": 1
																								
																							}
																						]
																					}
																				]
																			}
																		]
																	}
																]
																
															}
														]
													}
												]
											}
										]
									}
								]
							}
						]
					}
				]
			}
	
		]
		
	}
	]
  	}
	  ,
    {
		"name": "桑白皮","name2": "桑白皮","colour":"rgb(0,47,167)","fangji": "泻白散★",
		"children": 
		[
			{
				"name": "地骨皮","name2": "地骨皮","fangji": "泻白散★",
				"children":
				[
					{
						"name": "炙甘草","name2": "炙甘草","fangji": "泻白散★","size": 1
						
					}
				]
			}
		]
	}
	,
	  {
		"name": "滑石粉", "name2": "滑石粉","colour":"rgb(0,47,167)","fangji": "六一散、桂苓甘露饮",  
  		"children": 
		  [
			{
				"name": "肉桂","name2": "肉桂","fangji": "六一散、桂苓甘露饮",  
				"children": 
				[
					

					{
						"name": "甘草","name2": "甘草","fangji": "桂苓甘露饮",  
						"children": 
						[
							{
								"name": "茯苓","name2": "茯苓","fangji": "桂苓甘露饮",  
								"children":
								[
									{
										"name": "白术","name2": "白术","fangji": "桂苓甘露饮",  
										"children":
										[
											{
												"name": "泽泻","name2": "泽泻","fangji": "桂苓甘露饮",  
												"children":
												[
													{
														"name": "猪苓","name2": "猪苓","fangji": "桂苓甘露饮",  
														"children":
														[
															{
																"name": "石膏","name2": "石膏","fangji": "桂苓甘露饮",  "size": 1	
																}
														]
													}
												]
											}
										]
									}
								]
							}
						]
					}
					
				]
   			}
			   
		]
  	},
    {
		"name": "金银花","name2": "金银花","colour":"rgb(0,47,167)","fangji": "仙方活命饮★",
		"children": 
		[
			{
				"name": "当归","name2": "当归","fangji": "仙方活命饮★",
				"children":
				[
					{
						"name": "甘草","name2": "甘草","fangji": "仙方活命饮★",
						"children":
						[
							{
								"name": "陈皮","name2": "陈皮","fangji": "仙方活命饮★",
								"children":
								[
									{
										"name": "白芷","name2": "白芷","fangji": "仙方活命饮★",
										"children":
										[
													{
														"name": "天花粉","name2": "天花粉","fangji": "仙方活命饮★", 
														"children":
														[
															{
																"name": "川贝母","name2": "川贝母","fangji": "仙方活命饮★",
																"children":
																[
																	{
																		"name": "皂角刺","name2": "皂角刺","fangji": "仙方活命饮★",
																		"children":
																		[
																			{
																				"name": "乳香","name2": "乳香","fangji": "仙方活命饮★",
																				"children":
																				[
																					{
																						"name": "没药","name2": "没药","fangji": "仙方活命饮★",
																						"children":
																				[
																					{
																						"name": "防风","name2": "防风","fangji": "仙方活命饮★", 
																						"children":
																				[
																					{
																						"name": "赤芍","name2": "赤芍","fangji": "仙方活命饮★", "size": 1
																					
																					}
																				]
																					
																					}
																				]
																					
																					}
																				]
																			}
																		]
																	}
																]
															}
														]	
													}
												
											
										]
									}
								]
							}
						]
					}
				]
			}
		]
	}
	,
  {
		"name": "银柴胡","name2": "银柴胡","colour":"rgb(0,47,167)","fangji": "清骨散★",
		"children": 
		[
			{
				"name": "秦艽","name2": "秦艽","fangji": "清骨散★",
				"children":
				[
					{
						"name": "甘草","name2": "甘草","fangji": "清骨散★",
						"children":
						[
							{
								"name": "胡黄连","name2": "胡黄连","fangji": "清骨散★",
								"children":
								[
									{
										"name": "地骨皮","name2": "地骨皮","fangji": "清骨散★",
										"children":
										[
													{
														"name": "知母","name2": "知母","fangji": "清骨散★", 
														"children":
														[
															{
																"name": "青蒿","name2": "青蒿","fangji": "清骨散★",
																"children":
																[
																	{
																		"name": "鳖甲","name2": "鳖甲","fangji": "清骨散★", "size": 1
																		
																	}
																]
															}
														]	
													}
												
											
										]
									}
								]
							}
						]
					}
				]
			}
		]
	}
	,

	  {
		"name": "西洋参","name2": "西洋参","colour":"rgb(0,47,167)","fangji": "清暑益气汤",
		"children": 
		[
			{
				"name": "麦冬","name2": "麦冬","fangji": "清暑益气汤",
				"children":
				[
					{
						"name": "淡竹叶","name2": "淡竹叶","fangji": "清暑益气汤",
						"children":
						[
							{
								"name": "甘草","name2": "甘草","fangji": "清暑益气汤",
								"children":
								[
									{
										"name": "黄连","name2": "黄连","fangji": "清暑益气汤",
										"children":
										[
													{
														"name": "知母","name2": "知母","fangji": "清暑益气汤", 
														"children":
														[
															{
																"name": "石斛","name2": "石斛","fangji": "清暑益气汤","size": 1
																
															}
														]	
													}
												
											
										]
									}
								]
							}
						]
					}
				]
			}
		]
	}
	,
  {
		"name": "连翘","name2": "连翘","colour":"rgb(0,47,167)","fangji": "凉膈散★",
		"children": 
		[
			{
				"name": "栀子","name2": "栀子","fangji": "凉膈散★",
				"children":
				[
					{
						"name": "淡竹叶","name2": "淡竹叶","fangji": "凉膈散★",
						"children":
						[
							{
								"name": "甘草","name2": "甘草","fangji": "凉膈散★",
								"children":
								[
									{
										"name": "黄芩","name2": "黄芩","fangji": "凉膈散★",
										"children":
										[
													{
														"name": "芒硝","name2": "芒硝","fangji": "凉膈散★", 
														"children":
														[
															{
																"name": "大黄","name2": "大黄","fangji": "凉膈散★",
																"children":
																[
																	{
																		"name": "蜂蜜","name2": "蜂蜜","fangji": "凉膈散★",
																		"children":
																		[
																			{
																				"name": "薄荷","name2": "薄荷","fangji": "凉膈散★","size": 1
																				
																			}
																		]
																	}
																]
															}
														]	
													}
												
											
										]
									}
								]
							}
						]
					}
				]
			}
		]
	}
	,
  {
	"name": "木通","name2": "木通","colour":"rgb(0,47,167)","fangji": "导赤散★",
	"children": 
	[
		{
			"name": "地黄","name2": "地黄","fangji": "导赤散★",
			"children":
			[
				{
					"name": "淡竹叶","name2": "淡竹叶","fangji": "导赤散★",
					"children":
					[
						{
							"name": "甘草","name2": "甘草","fangji": "导赤散★","size": 1
							
						}
					]
				}
			]
		}
	]
}
,
{
	  "name": "白头翁","name2": "白头翁","colour":"rgb(0,47,167)","fangji": "白头翁汤★",
	  "children": 
	  [
		  {
			  "name": "黄柏","name2": "黄柏","fangji": "白头翁汤★",
			  "children":
			  [
				  {
					  "name": "秦皮","name2": "秦皮","fangji": "白头翁汤★",
					  "children":
					  [
						  {
							  "name": "黄连","name2": "黄连","fangji": "白头翁汤★","size": 1
							  
						  }
					  ]
				  }
			  ]
		  }
	  ]
  } 
  ,
	  {
		"name": "黄连","name2": "黄连", "colour":"rgb(0,47,167)","fangji": "左金丸（回令丸）★、黃连解毒汤★、清胃散★、普济消毒饮★",
  		"children": 
		  [
			{
				"name": " ","name2": "黄连",  "fangji": "左金丸（回令丸）★、黃连解毒汤★、清胃散★、普济消毒饮★",
				"children": 
		  [
			{
				"name": "吴茱萸","name2": "吴茱萸", "fangji": "左金丸（回令丸）★","size": 1
				
   			},
			   {
				"name": "黄柏","name2": "黄柏", "fangji": "黃连解毒汤★",		"children": 
				[
					{
						"name": "栀子","name2": "栀子","fangji": "黃连解毒汤★",
						"children":
						[
							{
								"name": "黄芩","name2": "黄芩","fangji": "黃连解毒汤★","size": 1
					
							}
						]
					}
				]
   			},
			   {
				"name": "地黄","name2": "地黄", "fangji": "清胃散★",		"children": 
				[
					{
						"name": "牡丹皮","name2": "牡丹皮","fangji": "清胃散★",
						"children":
						[
							{
								"name": "当归","name2": "当归","fangji": "清胃散★",
								"children":
								[
									{
										"name": "升麻","name2": "升麻","fangji": "清胃散★","size": 1
										
									}
								]
							}
						]
					}
				]
   			}
			   
			
			
		]
	},
	{
		"name": "黄芩","colour":"rgb(0,47,167)", "name2": "黄芩","fangji": "普济消毒饮★", 
		"children":
		[					
			{
				"name": "牛蒡子","name2": "牛蒡子","fangji": "普济消毒饮★", 
				"children":
				[
					{
						"name": "柴胡","name2": "柴胡","fangji": "普济消毒饮★", 
						"children": 
						[
							{
								"name": "陈皮","name2": "陈皮", "fangji": "普济消毒饮★",
								"children":
								[
									{
										"name": "升麻","name2": "升麻","fangji": "普济消毒饮★",  
										"children":
										[
											{
												"name": "甘草","name2": "甘草","fangji": "普济消毒饮★",  
												"children":
												[
													{
														"name": "玄参","name2": "玄参","fangji": "普济消毒饮★",  
														"children":
														[
															{
																"name": "连翘","name2": "连翘","fangji": "普济消毒饮★",  
																"children": 
													
																		[
																			{
																				"name": "板蓝根","name2": "板蓝根","fangji": "普济消毒饮★",
																				"children":
																				[
																					{
																						"name": "僵蚕","name2": "僵蚕","fangji": "普济消毒饮★",
																						"children":
																						[
																							{
																								"name": "薄荷","name2": "薄荷","fangji": "普济消毒饮★",
																								"children":
																						[
																							{
																								"name": "马勃","name2": "马勃","fangji": "普济消毒饮★",
																								"children":
																						[
																							{
																								"name": "桔梗","name2": "桔梗","fangji": "普济消毒饮★","size": 1
																								
																							}
																						]
																								
																							}
																						]
																								
																							}
																						]
																					}
																				]
																			}
																	
																]
																
															}
														]
													}
												]
											}
										]
									}
								]
							}
						]
					}
				]
			}
	
		]
		
	}
	]
  	},
	  {
		"name": "水牛角", "name2": "水牛角","colour":"rgb(0,47,167)","fangji": "犀角地黄汤★、一清营汤★",  
  		"children": 
		  [
			{
				"name": "地黄","name2": "地黄","fangji": "犀角地黄汤★、清营汤★",  
				"children": 
				[
	
				{
						"name": "牡丹皮","name2": "牡丹皮","fangji": "犀角地黄汤★",  
						"children": 	
						[
							{
								"name": "赤芍","name2": "赤芍","fangji": "犀角地黄汤★","size": 1
								
							}
						]	
					}
					,
					{
						"name": "丹参","name2": "丹参","fangji": "清营汤★",  
						"children": 
						[
							{
								"name": "黄连","name2": "黄连","fangji": "清营汤★",  
								"children":
								[
									{
										"name": "玄参","name2": "玄参","fangji": "清营汤★",  
										"children":
										[
											{
												"name": "麦冬","name2": "麦冬","fangji": "清营汤★",  
												"children":
												[
													{
														"name": "连翘","name2": "连翘","fangji": "清营汤★",  
														"children":
														[
															{
																"name": "淡竹叶","name2": "淡竹叶","fangji": "清营汤★",  
																"children":[
																	{
																		"name": "金银花","name2": "金银花","fangji": "清营汤★",   "size": 1	
																	}
																]
															}
														]
													}
												]
											}
										]
									}
								]
							}
						]
					}
					
				]
   			}
			   
			
		]
  	}
	  ,
	  {
		"name": "赤芍","colour":"rgb(0,47,167)","name2": "赤芍","fangji": "芍药汤★",
		"children": 
		[
			{
				"name": "肉桂","name2": "肉桂","fangji": "芍药汤★",
				"children":
				[
					{
						"name": "大黄","name2": "大黄","fangji": "芍药汤★",
						"children":
						[
							{
								"name": "黄连","name2": "黄连","fangji": "芍药汤★",
								"children":
								[
									{
										"name": "黄芩","name2": "黄芩","fangji": "芍药汤★",
										"children":
										[
											{
												"name": "甘草","name2": "甘草","fangji": "芍药汤★",
												"children":[
													{
														"name": "当归","name2": "当归","fangji": "芍药汤★",
														"children":[
															{
																"name": "木香","name2": "木香","fangji": "芍药汤★", 
																"children":[
																	{
																		"name": "槟榔","name2": "甘草","fangji": "芍药汤★", "size": 1	
																	}
																]	
															}
														]
													}
												]
											}
										]
									}
								]
							}
						]
					}
				]
			}
		]
	} ,
	{
		"name": "龙胆","colour":"rgb(0,47,167)","name2": "龙胆","fangji": "龙胆泻肝汤★",
		"children": 
		[
			{
				"name": "地黄","name2": "地黄","fangji": "龙胆泻肝汤★",
				"children":
				[
					{
						"name": "木通","name2": "木通","fangji": "龙胆泻肝汤★",
						"children":
						[
							{
								"name": "栀子","name2": "栀子","fangji": "龙胆泻肝汤★",
								"children":
								[
									{
										"name": "黄芩","name2": "黄芩","fangji": "龙胆泻肝汤★",
										"children":
										[
											{
												"name": "甘草","name2": "甘草","fangji": "龙胆泻肝汤★",
												"children":[
													{
														"name": "当归","name2": "当归","fangji": "龙胆泻肝汤★",
														"children":[
															{
																"name": "泽泻","name2": "泽泻","fangji": "龙胆泻肝汤★", 
																"children":[
																	{
																		"name": "柴胡","name2": "柴胡","fangji": "龙胆泻肝汤★", "size": 1	
																	}
																]	
															}
														]
													}
												]
											}
										]
									}
								]
							}
						]
					}
				]
			}
		]
	} ,

	  {
		"name": "青蒿","name2": "青蒿","colour":"rgb(0,47,167)","fangji": "青蒿鳖甲汤★",
		"children": 
		[
			{
				"name": "鳖甲","name2": "鳖甲","colour":"rgb(0,47,167)","fangji": "青蒿鳖甲汤★",
				"children":
				[
					{
						"name": "地黄","name2": "地黄","fangji": "青蒿鳖甲汤★",
						"children":
						[
							{
								"name": "知母","name2": "知母","fangji": "青蒿鳖甲汤★",
								"children":
								[
									{
										"name": "牡丹皮","name2": "牡丹皮","fangji": "青蒿鳖甲汤★","size": 1
										
									}
								]
							}
						]
					}
				]
			}
		]
	}
	,
	  {
		"name": "当归","name2": "当归","colour":"rgb(0,47,167)","fangji": "当归六黄汤★",
		"children": 
		[
			{
				"name": "熟地黄", "name2": "熟地黄","colour":"rgb(0,47,167)","fangji": "当归六黄汤★",
				"children":
				[
					{
						"name": "地黄","name2": "地黄","colour":"rgb(0,47,167)","fangji": "当归六黄汤★",
						"children":
						[
							{
								"name": "黄连","name2": "黄连","fangji": "当归六黄汤★",
								"children":
								[
									{
										"name": "黄芩","name2": "黄芩","fangji": "当归六黄汤★",
										"children":
										[
													{
														"name": "黄柏","name2": "黄柏","fangji": "当归六黄汤★", 
														"children":
														[
															{
																"name": "黄芪","name2": "黄芪","fangji": "当归六黄汤★","size": 1
																
															}
														]	
													}
												
											
										]
									}
								]
							}
						]
					}
				]
			}
		]
	}
	,	 
	  {
		"name": "葛根","name2": "葛根","colour":"rgb(0,47,167)","fangji": "葛根黄芩黄连汤★",
		"children": 
		[
			{
				"name": "黄芩","name2": "黄芩","fangji": "葛根黄芩黄连汤★",
				"children":
				[
					{
						"name": "黄连","name2": "黄连","fangji": "葛根黄芩黄连汤★",
						"children":
						[
							{
								"name": "炙甘草","name2": "炙甘草","fangji": "葛根黄芩黄连汤★","size": 1
								
							}
						]
					}
				]
			}
		]
	}
	,
	  {
		"name": "香薷","name2": "香薷","colour":"rgb(0,47,167)","fangji": "香薷散",
		"children": 
		[
			{
				"name": "白扁豆","name2": "白扁豆","fangji": "香薷散",
				"children":
				[
					{
						"name": "厚朴","name2": "厚朴","fangji": "香薷散","size": 1
						
					}
				]
			}
		]
	}
	,

	  {
		"name": "麻黄","name2": "麻黄","colour":"rgb(0,47,167)","fangji": "防风通圣散★",
		"children": 
		[
			{
				"name": "荆芥炭","name2": "荆芥炭","colour":"rgb(0,47,167)","fangji": "防风通圣散★",
				"children":
				[
					{
						"name": "薄荷","name2": "薄荷","colour":"rgb(0,47,167)","fangji": "防风通圣散★",
						"children":
						[
							{
								"name": "防风","name2": "防风","colour":"rgb(0,47,167)","fangji": "防风通圣散★",
								"children":
								[
									{
										"name": "当归","name2": "当归","fangji": "防风通圣散★",
										"children":
										[
													{
														"name": "川芎","name2": "川芎","fangji": "防风通圣散★", 
														"children":
														[
															{
																"name": "桔梗","name2": "桔梗","fangji": "防风通圣散★",
																"children":
																[
																	{
																		"name": "白术","name2": "白术","fangji": "防风通圣散★",
																		"children":
																		[
																			{
																				"name": "甘草","name2": "甘草","fangji": "防风通圣散★",
																				"children":
																				[
																					{
																						"name": "滑石粉","name2": "滑石粉","fangji": "防风通圣散★", 
																						"children":
						[
							{
								"name": "石膏","name2": "石膏","fangji": "防风通圣散★",
								"children":
								[
									{
										"name": "栀子","name2": "栀子","fangji": "防风通圣散★",
										"children":
										[
													{
														"name": "连翘","name2": "连翘","fangji": "防风通圣散★", 
														"children":
														[
															{
																"name": "黄芩","name2": "黄芩","fangji": "防风通圣散★",
																"children":
																[
																	{
																		"name": "芒硝","name2": "芒硝","fangji": "防风通圣散★",
																		"children":
																		[
																			{
																				"name": "白芍","name2": "白芍","fangji": "防风通圣散★",
																				"children":
																				[
																					{
																						"name": "大黄","name2": "大黄","fangji": "防风通圣散★", "size": 1
																					
																					}
																				]
																			}
																		]
																	}
																]
															}
														]	
													}
												
											
										]
									}
								]
							}
						]
																					
																					}
																				]
																			}
																		]
																	}
																]
															}
														]	
													}
												
											
										]
									}
								]
							}
						]
					}
				]
			}
		]
	}
]
}
  //
  
    var nodes = partition.nodes(treedata);
    var links = partition.links(nodes)

    svg0.selectAll(".node")
        .data(nodes)
        .enter().append("rect")
      .attr("id",function(d,i) {return "rec_" + i;}) // added
       .on("click", mouseclick)
        .attr("class", "node")
        .attr("x", function(d) { return d.x; })
        .attr("y", function(d) { return d.y; })
        .attr("width", function(d) { return d.dx; })
        .attr("height", function(d) { return d.dy; }) 
        .style("fill", function(d) { return color(d.name2); })
        .style("stroke",  "none")
    .style("opacity", 0.75);
    
  
      hh=svg0.selectAll(".node")
      var recnode=hh.flat()
      ////console.log(recnode)
      str=recnode[1].__data__. fangji
      var n=str.split("、");
      ////console.log(n);
  
  
    svg0.selectAll(".label")
        .data(nodes.filter(function(d) { return d.dx > 6; }))
        .enter().append("text")
        .attr("class", "label")
        .attr("dy", ".35em")
        .style("fill", function(d) { return d.colour; })
        // .attr("transform", function(d) { return "translate(" + (d.x + d.dx / 2) + "," + (d.y + d.dy / 2) + ")rotate(90)"; })
        .attr("transform", function(d) { return "translate(" + (d.x + d.dx / 2) + "," + (d.y + d.dy / 2) + ")"; })
        .text(function(d) { return d.name; });
        
  
        function highlightNodes(nodes, herbArray) {
    var num = 0; // 初始化计数器

    // 先重置所有节点的边框样式
    nodes.forEach((node, index) => {
        d3.select("#rec_" + index)
            .style("stroke", "none")
            .style("stroke-width", 0);
    });

    // 遍历 herbArray 中的每个元素
    for (var p = 0; p < herbArray.length; p++) {
        // 遍历所有节点
        var matchFound = false;
        for (var k = 0; k < nodes.length; k++) {
            // 如果节点的 name2 属性与 herbArray 中的当前元素匹配
            if (nodes[k].name2 === herbArray[p]) {
                num++; // 增加计数器
                matchFound = true;

                // 选择匹配的节点并应用样式
                d3.select("#rec_" + k)
                    .style("stroke", "rgb(0,47,167)")
                    .style("stroke-width", 2)
                    .style("stroke-opacity", 1)
                    .style("stroke-dasharray", "5,0");
            }
        }
        // 如果没有找到匹配项，重置对应节点的边框样式
        if (!matchFound) {
            nodes.forEach((node, index) => {
                if (node.name2 === herbArray[p]) {
                    d3.select("#rec_" + index)
                        .style("stroke", "none")
                        .style("stroke-width", 0);
                }
            });
        }
    }

}

function highlightFjRec(bb, fjrecdata) {
    let num3 = 0; // 初始化计数器

    // 先重置所有 fjrec 相关元素的边框
    fjrecdata.forEach((data, k) => {
        d3.select("#fjrec_" + k)
            .style("stroke", "none") // 移除边框
            .style("stroke-width", 0); // 边框宽度设置为0
    });

    // 遍历 bb 数组中的每个元素
    bb.forEach(bbb => {
        // 标记是否找到匹配
        let matchFound = false;

        // 遍历 fjrecdata 数组中的每个元素
        fjrecdata.forEach((data, k) => {
            // 检查当前元素 bbb 是否与 fjrecdata 中的 fj 属性匹配
            if (bbb === data.fj) {
                num3++; // 匹配成功时，增加计数器
                matchFound = true;

                // 选择匹配的节点并应用样式
                d3.select("#fjrec_" + k)
                    .style("stroke", "rgb(110,30,30)")
                    .style("stroke-width", 2)
                    .style("stroke-opacity", 1)
                    .style("stroke-dasharray", "5,0");
            }
        });

        // 如果没有找到匹配，重置所有非匹配项的边框
        if (!matchFound) {
            fjrecdata.forEach((data, k) => {
                if (bbb === data.fj) {
                    d3.select("#fjrec_" + k)
                        .style("stroke", "none")
                        .style("stroke-width", 0);
                }
            });
        }
    });

}








        
  
      var ttArray = new Array();  //先声明一维
        for(var k=0;k<nodes.length;k++){    //一维长度为i,i为变量，可以根据实际情况改变
         
        ttArray[k]=new Array();  //声明二维，每一个一维数组里面的一个元素都是一个数组；
         
        for(var j=0;j<26;j++){   //一维数组里面每个元素数组可以包含的数量p，p也是一个变量；
         
        ttArray[k][j]="";    //这里将变量初始化，我这边统一初始化为空，后面在用所需的值覆盖里面的值
         }
        }
    for(var k=0;k<nodes.length;k++){
        str=recnode[k].__data__. fangji
        var n=str.split("、");
        ttArray[k]=n
        
      }
    ////console.log(ttArray)
    function isContainArr(parent, child) {
          return child.every(item => {
          return parent.some(v => {
            return item == v
          })
          })
        }
        var fjrecdata=[{fj:"白虎汤★",fj1:"白虎汤",fj2:""},
        {fj:"玉女煎★",fj1:"玉女煎",fj2:""},
        {fj:"竹叶石膏汤★",fj1:"竹叶石",fj2:"汤"},
        {fj:'清瘟败毒饮',fj1:"清瘟败",fj2:"毒饮"},
        {fj:"泻白散★",fj1:"泻白散",fj2:""},
        {fj:"六一散&桂苓甘露饮",fj1:"六一散",fj2:"桂苓甘露饮"},
        {fj:"仙方活命饮★",fj1:"仙方活",fj2:"命饮"},
        {fj:"清骨散★",fj1:"清骨散",fj2:""},
        {fj:"清暑益气汤",fj1:"清暑益",fj2:"气汤"},
        {fj:"凉膈散★",fj1:"凉膈散",fj2:""},
        {fj:"导赤散★",fj1:"导赤散",fj2:""},
        {fj:'白头翁汤★',fj1:"白头翁",fj2:"汤"},

        {fj:"左金丸（回令丸）",fj1:"左金丸",fj2:"（回令丸）"},
        {fj:"黃连解毒汤★",fj1:"黃连解",fj2:"毒汤"},
        {fj:"清胃散★",fj1:"清胃散",fj2:""},
        {fj:"普济消毒饮★",fj1:"普济消",fj2:"毒饮"},

        {fj:"犀角地黄汤★",fj1:"犀角地",fj2:"黄汤"},
         {fj:'清营汤★',fj1:"清营汤",fj2:""},
        {fj:"芍药汤★",fj1:"芍药汤",fj2:""},
        {fj:'龙胆泻肝汤★',fj1:"龙胆泻",fj2:"肝汤"},
        {fj:'青蒿鳖甲汤★',fj1:"青蒿鳖",fj2:"甲汤"},
        {fj:"当归六黄汤★",fj1:"当归六",fj2:"黄汤"},
        {fj:"葛根黄芩黄连汤★",fj1:"葛根黄",fj2:"芩黄连汤"},
        {fj:"香薷散",fj1:"香薷散",fj2:""},
        {fj:"防风通圣散★",fj1:"防风通",fj2:"圣散"}
        
        
       
        
        
        
        
      ]
        fjy=[]
   fjindex=0
    for(var k=0;k<nodes.length;k++){
            if(nodes[k].size==1){
////console.log(nodes[k].y)
fjy.push(nodes[k].y+50)
fjrecdata[fjindex].newy=(nodes[k].y+90)
fjindex=fjindex+1
      }

        }
  ////console.log(fjrecdata)
  svg0.selectAll(".fjnode")
        .data(fjrecdata)
        .enter().append("rect")
      .attr("id",function(d,i) {return "fjrec_" + i;}) // added
        .attr("class", "fjnode")
        .attr("x", function(d,i) { return i*treewidth/25; })
        .attr("y",function(d) { return (d.newy-30); })
        .attr("width", function(d) { return treewidth/25; })
        .attr("height", 50)
        .style("fill", "none")
      .style("stroke", "none")
      .style("stroke-width", 1)

      svg0.selectAll(".fjlabel")
      .data(fjrecdata)
        .enter().append("text")
        .attr("class", "fjlabel")
        .attr("dy", "0em")
        .attr("transform", function(d,i) { return "translate(" + (i*treewidth/25 + treewidth/50) + ","+(d.newy-10)+")"; })
      // .attr("transform", function(d,i) { return "translate(" + (i*treewidth/20 + treewidth/40) + ","+(d.newy+20)+")"; })
        .text(function(d) { return d.fj1; })

        svg0.selectAll(".fjlabel2")
      .data(fjrecdata)
        .enter().append("text")
        .attr("class", "fjlabel2")
        .attr("dy", "0.5em")
        .attr("transform", function(d,i) { return "translate(" + (i*treewidth/25 + treewidth/50) + ","+(d.newy)+")";})
      // .attr("transform", function(d,i) { return "translate(" + (i*treewidth/20 + treewidth/40) + ","+(d.newy+31)+")";})
        .text(function(d) { return d.fj2; })

        

  // svg1.selectAll(".fjnode")
  //       .data(fjrecdata)
  //       .enter().append("rect")
  //     .attr("id",function(d,i) {return "fjrec_" + i;}) // added
  //       .attr("class", "fjnode")
  //       .attr("x", function(d,i) { return i*treewidth/20; })
  //       .attr("y",30)
  //       .attr("width", function(d) { return treewidth/20; })
  //       .attr("height", 50)
  //       .style("fill", "none")
  //     .style("stroke", "blue")
  //     .style("stroke-width", 1)
  
  //     svg1.selectAll(".fjlabel")
  //     .data(fjrecdata)
  //       .enter().append("text")
  //       .attr("class", "fjlabel")
  //       .attr("dy", "0em")
  //   //   .attr("transform", function(d) { return "translate(" + (d.x + d.dx / 2) + "," + (d.y + d.dy / 2) + ")"; })
  //     .attr("transform", function(d,i) { return "translate(" + (i*treewidth/20 + treewidth/40) + ",52)"; })
  //       .text(function(d) { return d.fj1; })

  //       svg1.selectAll(".fjlabel2")
  //     .data(fjrecdata)
  //       .enter().append("text")
  //       .attr("class", "fjlabel2")
  //       .attr("dy", "0.5em")
  //   //   .attr("transform", function(d) { return "translate(" + (d.x + d.dx / 2) + "," + (d.y + d.dy / 2) + ")"; })
  //     .attr("transform", function(d,i) { return "translate(" + (i*treewidth/20 + treewidth/40) + ",63)"; })
  //       .text(function(d) { return d.fj2; })
  
      d3.csv("qrfangjidata0504.csv", function(error, data) { 
  function findrgb(k) {

  for(var i=0;i<data.length;i++){
  if(data[i].herb==recnode[k].__data__. name2){
  return data[i].rgb
  }
  }
  
}


      ondiv.onclick=function(){ 
          aaaa=lasso_end();
          aa=herbArray
          bb=aaaa[0]
          ////console.log(aa)		
          svg0.selectAll(".node")
          .data(nodes)
          .on("click", mouseclick)
          .style("stroke", "none")
          console.log(herbArray+"1997")


    for(var k=1;k<nodes.length;k++){
   ////console.log(findrgb(k))
    d3.select("#rec_"+k)
    .style("fill",function() { return findrgb(k)})
  }
  
          svg0.selectAll(".fjnode")
          .style("stroke","none")
          
          var num2=0
          for(var p=0;p<bb.length;p++){
            bbb=[bb[p]]
            for(var k=1;k<nodes.length;k++){
                if(isContainArr(ttArray[k], bbb)==true)
                {
                num2=num2+1
                for(var i=0;i<num2;i++){
                d3.select("#rec_"+k)
                .on("mouseover", mouseover3)
                .on("mousemove", mousemove3)
                .on("mouseleave", mouseleave3)
                .style("stroke", "rgb(110,30,30)")
                .style("stroke-width", 2)
                .style("stroke-dasharray","3,5")
              }
                }
            }
  
          }
    
          nodek=[]
          var num=0
          for(var p=0;p<herbArray.length;p++){
            for(var k=0;k<nodes.length;k++){
          if(recnode[k].__data__. name2==herbArray[p]){
            num=num+1;
            
            for(var i=0;i<num;i++){
              //nodek.push(nodes[k])
              d3.select("#rec_"+k)
              //.on("click", mouseclick2)
              .style("stroke", "rgb(0,47,167)")
              .style("stroke-width", 2)
              .style("stroke-opacity",1)
              .style("stroke-dasharray","5,0")
              //.style("fill", t.url())
            }					
          }
        }
          }	
          
      var num3=0
      for(var p=0;p<bb.length;p++){
        bbb=bb[p]
        ////console.log(bbb)
        for(var k=0;k<fjrecdata.length;k++){
            if(bbb==fjrecdata[k].fj)
            {
            num3=num3+1
            for(var i=0;i<num3;i++){
            //svg1.call(tt)
            d3.select("#fjrec_"+k)
            .style("stroke", "rgb(110,30,30)")
            // .style("fill", "red")
          }
            }
        }
  
      }
  
  
        }
  
  // });
  


 
//   //console.log(data)
//   function findrgb(k) {

//   for(var i=0;i<data.length;i++){
//   if(data[i].herb==recnode[k].__data__. name2){
//   //console.log("i=",i,"k=",k)
//   return data[i].rgb
//   }
//   }
  
// }


  for(var k=1;k<nodes.length;k++){
   ////console.log(findrgb(k))
    d3.select("#rec_"+k)
    .style("fill",function() { return findrgb(k)})
  }
  


  })
  
  
    
  
    
  
  


  
  </script>

</div id="setview">

<div align="center" id="chart01">
</div>
<div align="center" id="chart02">
</div>

<script>

var useGroupInABox = false,
  drawTemplate = false,
  template = "none";

d3.select("#selectTemplate").property("value", template);
d3.select("#checkShowTemplate").property("checked", drawTemplate);

var margin = {top: 0, right: 0, bottom: 0, left: 0},
    width = 30,
    height = 30;

// var force = d3.forceSimulation()
//     .force("charge", d3.forceManyBody())
//     .force("x", d3.forceX(width/2))
//     .force("y", d3.forceY(height/2));
// var force = d3.layout.force().nodes(nodes)
//         .size([width, height])
//         .charge();

// var svg01 = d3.select("#chart01").append("svg")
//     .attr("id", "svg01")
//     .attr("width", width)
//     .attr("height", height)
//     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
// var legend01 = d3.select("#chart01").append("svg")
//     .attr("id", "legend01")
//     .attr("width", 270)
//     .attr("height", height)
//     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
var margin = {top: 150, right: 0, bottom: 0, left: 150},
    width = 510,
    height = 510;

var x = d3.scale.ordinal().rangeRoundBands([0, width]),
    z = d3.scale.linear().domain([0, 5]).clamp(true);
// var  colmap = d3.scaleOrdinal(d3.schemeCategory10).domain(d3.range(10));

    
// var svg02 = d3.select("#chart02").append("svg")
//     .attr("id", "svg02")
//     .attr("width", width + margin.left + margin.right)
//     .attr("height", height + margin.top + margin.bottom)
//   .append("g")
//     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
var legend02 = d3.select("#chart02").append("svg")
    .attr("id", "legend02")
    .attr("width", 290)
    .attr("height", height + margin.top + margin.bottom);

function createGraphs() { 

  var nodes;
  var links;
  var groups;

  d3.csv("nodes.csv", function(error, data) {

    if (error) throw error;
    nodes = data;
    
    groups = d3.nest()
      .key(function(d) { return d.group; })
      .entries(nodes);    
    
    groups.forEach(function(d,i) {
    
      var str = "";
      var tmpX;
      var tmpY;
      
      // legend01.append('rect')                                     
      //   .attr('x', 35 )
      //   .attr('y', ((parseFloat(d3.select('#legend01').style('height')) - (groups.length * 22)) / 2) + (i * 22))
      //   .attr('width', 18)                          
      //   .attr('height', 18)                         
      //   .style('fill', function() { return colmap(d.key); })                               
      //   .style("fill-opacity", 0.7)
      //   .style('stroke', function() { return colmap(d.key); });                               
        
      // legend01.append('text') 
      //   .attr('x', 60)              
      //   .attr('y', ((parseFloat(d3.select('#legend01').style('height')) - (groups.length * 22)) / 2) + 14 + (i * 22))
      //   .attr("class", "legend")
      //   .text( d.key );
        
      // legend02.append('rect')                                     
      //   .attr('x', 60 )
      //   .attr('y', ((parseFloat(d3.select('#legend02').style('height')) - (groups.length * 22)) / 2) + (i * 22))
      //   .attr('width', 18)                          
      //   .attr('height', 18)                         
      //   .style('fill', function() { return colmap(d.key); })                               
      //   .style("fill-opacity", 0.7)
      //   .style('stroke', function() { return colmap(d.key); });            
              
      // legend02.append('text') 
      //   .attr('x', 85)
      //   .attr('y', ((parseFloat(d3.select('#legend02').style('height')) - (groups.length * 22)) / 2) + 14 + (i * 22))
      //   .attr("class", "legend")
      //   .text( d.key );
      
    });

    var gsetData = [];
    var setIntersects = [];
    var setNames = [];
    d3.csv("qingrejiupdate.csv", function(error, data){
    // d3.csv("qingrejiupdate.csv", function(error, data){
        if(error) throw error;
        sets = data;
        ////console.log(sets);
        var setCols = 16
        var colNames = ['setId', 'd1', 'd2', 'd3', 'd4', 'd5', 'd6', 'd7', 'd8', 'd9', 'd10', 'd11', 'd12', 'd13', 'd14', 'd15']
        // //console.log(colNames);
        var setRows = sets.length;
        ////console.log(setRows);
        ////console.log(setCols);
        data.forEach(function(d){
            
            // //console.log(d);
            var set = [];
            set.drugArray = [];
            set.id = d.setId;
            for(var i=1; i < setCols; i++){
                // //console.log(d[colNames[i]]);
                if(d[colNames[i]] === undefined )
                    continue;
                else
                 set.drugArray.push(d[colNames[i]]);
            }
            // //console.log(set);

            gsetData.push(set);
            setNames.push(set.id);
        });
        //console.log(gsetData);
        //console.log(setRows);
    
        setIntersects = [];
        var maxCardi = -1;
        var minCardi = 1;
        var CountcoOccur = 0;
        medcoOccur=new Array();
        for(var ii=0; ii<setRows;ii++)
        {
            setIntersects[ii] = [];
            for(var jj = 0; jj < setRows; jj++){
                
                var dArray1 = gsetData[ii].drugArray;
                var dArray2 = gsetData[jj].drugArray;
                // //console.log(dArray1.length)
                // //console.log(dArray2.length)
                // //console.log(dArray1)
                // //console.log(dArray2)
                var coOccur = 0;
                
                for(var c = 0; c < dArray1.length; c++){
                    for(var c2 = 0; c2 < dArray2.length; c2++)
                        {
                        if (ii == jj)
                          continue;
                        if(dArray1[c] == dArray2[c2]){
                          // //console.log("c"+c+"c2"+c2+dArray1[c])
                          coOccur ++;
                          // //console.log("ii"+ii+"jj"+jj+"coOccur"+coOccur)
                        }
                        
                        }
                }
                // //console.log(coOccur);
                CountcoOccur=CountcoOccur+coOccur
                medcoOccur.push(coOccur)
                
                if( coOccur > maxCardi) 
                   maxCardi = coOccur;
                if( coOccur < minCardi)
                  minCardi = coOccur;
                setIntersects[ii][jj] = {val:coOccur, x:jj, y:ii};
                // minCardi = min(coOccur, minCardi);
            }
        }
        //console.log(setIntersects);
        //console.log(maxCardi);
        //console.log(minCardi);
        //console.log(CountcoOccur/400);
        //console.log(medcoOccur);

function medianof2Arr(arr1) {

var concat = arr1;

concat = concat.sort(

    function(a, b) {

        return a - b

    });

//console.log(concat);

var length = concat.length;

if (length % 2 == 1) {

    // 如果长度是奇数

    //console.log("中位数为： "+(concat[(length / 2) - 0.5]))

} else {

    // 如果长度是偶数

    //console.log("中位数为： "+(concat[length / 2]+concat[(length / 2) - 1]) / 2);



}

}
medianof2Arr(medcoOccur)
        // var  colmap = d3.scaleOrdinal(d3.schemeBlues[maxCardi+1]).domain(d3.range(10));
        // var colmap = d3.scale.category10(); 
        //    var colmap = d3.scale.linear()
        //  .range(["white", "#0b1746"])
        //  .domain([0,maxCardi])
        var colmap=["RGB(239,243,255)","RGB(198,219,239)","RGB(158,202,225)","RGB(107,174,214)","RGB(66,146,198)","RGB(33,113,181)","RGB(8,69,148)"]
        
       var indexArray = [];
       indexArray = setNames.map(function(d,i) {return i;});
      //  //console.log(indexArray);
       
				x.domain(indexArray);
      // //console.log(x.bandwidth());
      // //console.log(x(0));
      // //console.log(x(1));
      svg02.append("rect")
          .attr("class", "background")
          .attr("width", width)
          .attr("height", height);    
      
          // define a hatch pattern
      svg02
        .append('defs')
        .append('pattern')
        .attr('id', 'diagonalHatch')
        .attr('patternUnits', 'userSpaceOnUse')
        .attr('width', 5)
        .attr('height', 5)
        .append('path')
        // .attr('d', 'M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2')
        .attr('d', 'M0,0 l5,5 M5,0 l-5,5')
        .attr('stroke', '#000000')
        .attr('stroke-width', 0.5);


      var row = svg02.selectAll(".row")
          .data(setIntersects)
        .enter().append("g")
          .attr("class", "row")
          .attr("transform", function(d, i) { return "translate(0," + x(i) + ")"; })
          .each(rowDraw);

      row.append("line")
          .attr("x2", width);

      row.append("text")
          .attr("x", -6)
          .attr("y", x.rangeBand() / 2)
          .attr("dy", ".32em")
          .attr("text-anchor", "end")
          .text(function(d, i) { return gsetData[i].id; });

      var column = svg02.selectAll(".column")
          .data(setIntersects)
        .enter().append("g")
          .attr("class", "column")
          .attr("transform", function(d, i) { return "translate(" + x(i) + ")rotate(-90)"; });

      column.append("line")
          .attr("x1", -width);

      column.append("text")
          .attr("x", 6)
          .attr("y", x.rangeBand() / 2)
          .attr("dy", ".32em")
          .attr("text-anchor", "start")
          .text(function(d, i) { return gsetData[i].id; });

      function rowDraw(row, j) {
        // //console.log(j);
        var cell = d3.select(this).selectAll(".cellAM")
          .data(function(row, j) 
          { 
            return row;
            // var uppertriangle = row.filter(function (d, i) { if(i > j) return d.val; });
            // //console.log(uppertriangle);
            // return uppertriangle;
          })
          .enter()
          .append("rect")
          .attr("class", "cellAM")
          .attr("x", function (d) { return x(d.x); })
          .attr("width", x.rangeBand())
          .attr("height", x.rangeBand())
          // .style("fill-opacity", function (d, i) { 
          //   if(j == i)
          //     return 1;
          //   else
          //     return z(d.val); })
          .style("fill", function (d,i) 
                { 
                  if(i == j)
                    return "url(#diagonalHatch)";
                  else
                    return colmap[d.val]; 
                }) 
          .on("mouseover", mouseover)
          .on("mouseout", mouseout);
      }

      function mouseover(p) {
        d3.selectAll(".row text").classed("active", function (d, i) { return i == p.y; });
        d3.selectAll(".column text").classed("active", function (d, i) { return i == p.x; });
        // //console.log(d3.selectAll(".active")[0][0].id)
        // //console.log(d3.selectAll(".active")[0][1].id)
        // //console.log(p)
        // //console.log(p.x) //column
        // //console.log(p.y) //row
        pcolumn=p.x
        prow=p.y
        jiarray=d3.selectAll(".fjnode")[0]
        //console.log(jiarray[0])

        for(var pp=0;pp<setRows-1;pp++){
          if(jiarray[pp].id=="fjrec_"+prow){
                 d3.select("#fjrec_"+prow)
            //.style("stroke", "red")
            .style("stroke", "rgb(110,30,30)")
          }
          if(jiarray[pp].id=="fjrec_"+pcolumn){
                 d3.select("#fjrec_"+pcolumn)
            //.style("stroke", "red")
            .style("stroke", "rgb(110,30,30)")
          }
        }

      }

      function mouseout() {
        d3.selectAll("text").classed("active", false);
        d3.selectAll(".fjnode")
        .style("stroke", "none")
      }

      // Add legends
      var cardiNums = d3.range(0,maxCardi+1);
      //console.log(cardiNums);
      for(var i = 0; i < cardiNums.length; i++){
        legend02.append('rect')                         
        .attr('x', 60 )
        .attr('y', ((parseFloat(d3.select('#legend02').style('height')) - (maxCardi * 22)) / 2) + (i * 22))
        .attr('width', 18)                          
        .attr('height', 18)                         
        .style('fill', function() { return colmap[cardiNums[i]]; })                               
        .style("fill-opacity", 1)
        .style('stroke', function() { return colmap[cardiNums[i]]; });            
    // add title
    legend02.append('text')
    .attr('x', 20)
    .attr('y', ((parseFloat(d3.select('#legend02').style('height')) - (maxCardi * 22)) / 2) + 14 + (-1 * 22))
    .attr("class", "legend")
    .text("#Shared Medicines");

      legend02
        .append('text') 
        .attr('x', 85)
        .attr('y', ((parseFloat(d3.select('#legend02').style('height')) - (maxCardi * 22)) / 2) + 14 + (i * 22))
        // .attr('y', ((parseFloat(d3.select('#legend02').style('height')) - (maxCardi * 22)) / 2) + 14 + (i * 22))
        .attr("class", "legend")
        .text( cardiNums[i] );
      }
   

    });
    
  
    
   });

}

function dragstarted(d) {
  if (!d3.event.active) force.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) force.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

createGraphs();
  
</script>


</div>  

  
<script>
  // 确保 DOM 完全加载完成后添加事件监听器
  document.addEventListener('DOMContentLoaded', function() {
      var logButton = document.getElementById('logButton');
      logButton.addEventListener('click', function() {
          // 在全局对象上检查herbArray是否存在，并输出
          if (window.myAppData && window.myAppData.herbArray) {
              console.log(window.myAppData.herbArray);
          } else {
              console.log('Herb Array is not available.');
          }
      });
  });
</script>
  
  
</html>